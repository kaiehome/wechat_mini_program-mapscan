<!--pages/stamps/stamps.wxml-->
<view class="container">
  <!-- 统计信息 -->
  <view class="statistics-section">
    <view class="statistics-title">收集进度</view>
    <view class="statistics-content">
      <view class="stat-item">
        <view class="stat-number">{{statistics.completed}}</view>
        <view class="stat-label">已收集</view>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <view class="stat-number">{{statistics.remaining}}</view>
        <view class="stat-label">待收集</view>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <view class="stat-number">{{statistics.completionRate}}%</view>
        <view class="stat-label">完成率</view>
      </view>
    </view>
    
    <!-- 进度条 -->
    <view class="progress-bar">
      <view 
        class="progress-fill" 
        style="width: {{statistics.completionRate}}%">
      </view>
    </view>
  </view>

  <!-- 印章展示 -->
  <view class="stamps-section">
    <view class="stamps-title">电子印章</view>
    <view class="stamps-grid">
      <view 
        class="stamp-item {{item.isCompleted ? 'completed' : 'pending'}}"
        wx:for="{{stamps}}" 
        wx:key="id"
        bindtap="onStampTap"
        data-stamp-id="{{item.id}}">
        
        <!-- 印章图标 -->
        <view class="stamp-icon">
          <image 
            src="{{item.isCompleted ? item.stampImage : '/images/stamps/placeholder.png'}}" 
            class="stamp-image">
          </image>
          <view class="stamp-status {{item.isCompleted ? 'completed' : 'pending'}}">
            {{item.isCompleted ? '✓' : '○'}}
          </view>
        </view>
        
        <!-- 印章信息 -->
        <view class="stamp-info">
          <view class="stamp-name">{{item.name}}</view>
          <view class="stamp-area">{{item.area}}</view>
          <view class="stamp-time" wx:if="{{item.isCompleted}}">
            {{item.completionTime}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 操作按钮 -->
  <view class="action-section">
    <button class="action-btn btn-primary" bindtap="viewCompletionStatus">
      {{userProgress.completionStatus ? '查看奖品信息' : '查看完成情况'}}
    </button>
    <view class="action-row">
      <button class="action-btn btn-secondary" bindtap="goToMap">
        查看地图
      </button>
      <button class="action-btn btn-success" bindtap="goToScan">
        继续打卡
      </button>
    </view>
    <button class="action-btn btn-warning" bindtap="resetProgress">
      重置进度
    </button>
  </view>

  <!-- 完成提示 -->
  <view class="completion-section" wx:if="{{userProgress.completionStatus}}">
    <view class="completion-title">🎉 恭喜完成！</view>
    <view class="completion-content">
      您已成功集齐所有电子印章！<br/>
      请前往签到处（手工区）领取精美奖品。
    </view>
    <view class="completion-tips">
      <view class="tip-item">🏆 奖品丰厚，不容错过</view>
      <view class="tip-item">📍 签到处：手工区</view>
      <view class="tip-item">⏰ 活动期间有效</view>
    </view>
  </view>

  <!-- 印章动画 -->
  <view class="stamp-animation" wx:if="{{showAnimation}}">
    <view class="animation-stamp">
      <image src="{{animationStamp.stampImage}}" class="animation-image"></image>
      <view class="animation-text">+1</view>
    </view>
  </view>
</view>