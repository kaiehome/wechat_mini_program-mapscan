<!--pages/stamps/stamps.wxml-->
<view class="stamps-container">
  <!-- å¤´éƒ¨è¿›åº¦æ˜¾ç¤º -->
  <view class="header-section">
    <view class="progress-card">
      <view class="progress-title">å»‰æ´æ¢ç´¢è¿›åº¦</view>
      <view class="progress-stats">
        <view class="stat-item">
          <text class="stat-number">{{userProgress.completedStamps.length}}</text>
          <text class="stat-label">å·²å®Œæˆ</text>
        </view>
        <view class="stat-divider">/</view>
        <view class="stat-item">
          <text class="stat-number">{{userProgress.totalStamps}}</text>
          <text class="stat-label">æ€»ç‚¹ä½</text>
        </view>
      </view>
      
      <view class="progress-bar">
        <view 
          class="progress-fill" 
          style="width: {{(userProgress.completedStamps.length / userProgress.totalStamps) * 100}}%">
        </view>
      </view>

      <view class="completion-status" wx:if="{{userProgress.completionStatus}}">
        <view class="completion-icon">ğŸ‰</view>
        <view class="completion-text">æ­å–œï¼æ‚¨å·²å®Œæˆæ‰€æœ‰æ‰“å¡</view>
      </view>
    </view>
  </view>

  <!-- å°ç« å±•ç¤ºåŒºåŸŸ -->
  <view class="stamps-section">
    <view class="section-title">ç”µå­å°ç« æ”¶è—</view>
    
    <view class="stamps-grid">
      <view 
        class="stamp-item {{item.isCompleted ? 'completed' : 'pending'}}"
        wx:for="{{stamps}}" 
        wx:key="id"
        bindtap="onStampTap"
        data-id="{{item.id}}">
        
        <view class="stamp-icon">
          <image 
            src="{{item.isCompleted ? item.stampImage : '/images/stamps/locked.png'}}" 
            class="stamp-image">
          </image>
          <view class="stamp-status" wx:if="{{item.isCompleted}}">âœ“</view>
        </view>
        
        <view class="stamp-info">
          <view class="stamp-name">{{item.name}}</view>
          <view class="stamp-time" wx:if="{{item.isCompleted}}">
            {{item.completionTime}}
          </view>
          <view class="stamp-time" wx:else>
            å¾…å®Œæˆ
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
  <view class="action-section">
    <button class="btn-primary" bindtap="startScan">
      ç»§ç»­æ‰«ç æ‰“å¡
    </button>
    <button class="btn-secondary" bindtap="goToMap">
      æŸ¥çœ‹åœ°å›¾
    </button>
  </view>

  <!-- å°ç« è¯¦æƒ…å¼¹çª— -->
  <view class="stamp-detail-modal {{showStampDetail ? 'show' : ''}}" wx:if="{{selectedStamp}}">
    <view class="modal-mask" bindtap="closeStampDetail"></view>
    <view class="modal-content">
      <view class="modal-header">
        <view class="modal-title">{{selectedStamp.name}}</view>
        <view class="modal-close" bindtap="closeStampDetail">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="stamp-preview">
          <image src="{{selectedStamp.stampImage}}" class="preview-image"></image>
        </view>
        
        <view class="stamp-description">
          {{selectedStamp.description}}
        </view>
        
        <view class="stamp-details">
          <view class="detail-item">
            <text class="detail-label">çŠ¶æ€ï¼š</text>
            <text class="detail-value {{selectedStamp.isCompleted ? 'completed' : 'pending'}}">
              {{selectedStamp.isCompleted ? 'å·²å®Œæˆ' : 'å¾…å®Œæˆ'}}
            </text>
          </view>
          
          <view class="detail-item" wx:if="{{selectedStamp.isCompleted}}">
            <text class="detail-label">å®Œæˆæ—¶é—´ï¼š</text>
            <text class="detail-value">{{selectedStamp.completionTime}}</text>
          </view>
          
          <view class="detail-item">
            <text class="detail-label">ç±»å‹ï¼š</text>
            <text class="detail-value">{{selectedStamp.type === 'signin' ? 'ç­¾åˆ°ç‚¹' : 'æ‰“å¡ç‚¹'}}</text>
          </view>
        </view>
      </view>
      
      <view class="modal-footer">
        <button class="btn-secondary" bindtap="closeStampDetail">å…³é—­</button>
      </view>
    </view>
  </view>

  <!-- å¼€å‘è€…å·¥å…· -->
  <view class="dev-tools" wx:if="{{false}}">
    <button class="btn-secondary" bindtap="resetProgress">é‡ç½®è¿›åº¦</button>
    <button class="btn-secondary" bindtap="exportProgress">å¯¼å‡ºè¿›åº¦</button>
  </view>
</view>
