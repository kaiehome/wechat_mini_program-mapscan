<!--pages/scan/scan.wxml-->
<view class="scan-container">
  <!-- 扫码提示区域 -->
  <view class="scan-header">
    <view class="scan-title">廉洁探索之旅</view>
    <view class="scan-subtitle">扫描二维码开始打卡集赞</view>
  </view>

  <!-- 扫码按钮区域 -->
  <view class="scan-content">
    <view class="scan-icon">
      <image src="/images/icons/scan-large.png" class="scan-image"></image>
    </view>
    
    <button 
      class="scan-button {{isScanning ? 'scanning' : ''}}" 
      bindtap="startScan"
      disabled="{{isScanning}}">
      <view wx:if="{{!isScanning}}">点击开始扫码</view>
      <view wx:else>正在扫码...</view>
    </button>

    <view class="scan-tips">
      <view class="tip-item">• 请将二维码放入框内</view>
      <view class="tip-item">• 确保光线充足</view>
      <view class="tip-item">• 保持手机稳定</view>
    </view>
  </view>

  <!-- 进度显示区域 -->
  <view class="progress-section">
    <view class="progress-title">打卡进度</view>
    <view class="progress-info">
      <text class="progress-text">
        已完成 {{userProgress.completedStamps.length}} / {{userProgress.totalStamps}} 个点位
      </text>
    </view>
    
    <view class="progress-bar">
      <view 
        class="progress-fill" 
        style="width: {{(userProgress.completedStamps.length / userProgress.totalStamps) * 100}}%">
      </view>
    </view>

    <view class="checkpoint-status">
      <view 
        class="status-item {{userProgress.completedStamps.includes(item.id) ? 'completed' : 'pending'}}"
        wx:for="{{checkpoints}}" 
        wx:key="id">
        <view class="status-icon">
          <image src="{{userProgress.completedStamps.includes(item.id) ? '/images/icons/check.png' : '/images/icons/circle.png'}}"></image>
        </view>
        <text class="status-name">{{item.name}}</text>
      </view>
    </view>
  </view>

  <!-- 操作按钮区域 -->
  <view class="action-section">
    <button class="btn-secondary" bindtap="goBack">
      返回地图
    </button>
    <button class="btn-primary" bindtap="viewProgress">
      查看印章
    </button>
  </view>

  <!-- 扫码结果提示 -->
  <view class="scan-result" wx:if="{{scanResult}}">
    <view class="result-title">扫码成功！</view>
    <view class="result-content">
      已获得对应点位的电子印章
    </view>
  </view>
</view>
