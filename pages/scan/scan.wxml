<!--pages/scan/scan.wxml-->
<view class="container" style="padding-top: {{navBarHeight}}px;">
  <!-- 自定义导航栏 -->
  <view class="custom-navbar" style="padding-top: {{statusBarHeight}}px; height: {{navBarHeight}}px;">
    <text class="nav-title">扫码打卡</text>
  </view>


  <!-- 使用说明 -->
  <view class="instruction-section">
    <view class="instruction-title">使用说明</view>
    <view class="instruction-content">
      <view class="instruction-item">
        <view class="item-number">1</view>
        <view class="item-text">请先到大厅手工区扫码签到</view>
      </view>
      <view class="instruction-item">
        <view class="item-number">2</view>
        <view class="item-text">然后按任意顺序扫描其他5个点位</view>
      </view>
      <view class="instruction-item">
        <view class="item-number">3</view>
        <view class="item-text-block">
          <view class="item-text">集齐所有电子印章后即可领取奖品</view>
          <view class="item-subtext">（数量有限，先到先得）</view>
        </view>
      </view>
    </view>
  </view>

<!-- 当前进度 -->
  <view class="progress-section">
    <view class="progress-title">当前进度</view>
    <view class="progress-info">
      <view class="progress-text">
        已完成 {{userProgress.completedStamps.length}}/{{userProgress.totalStamps}} 个点位 ({{progressPercentage}}%)
      </view>
      <view class="progress-bar">
        <view 
          class="progress-fill" 
          style="width: {{progressPercentage}}%;">
        </view>
      </view>
    </view>
    
    <!-- 印章墙 -->
    <view class="stamps-wall">
      <view 
        class="stamp-item {{userProgress.completedStamps.includes(item.id) ? 'completed' : 'uncompleted'}}" 
        wx:for="{{stamps}}" 
        wx:key="id"
        data-stamp-id="{{item.id}}"
        bindtap="onStampTap">
        <image class="stamp-image" src="{{item.stampImage}}" mode="aspectFit"></image>
        <view class="stamp-name">{{item.name}}</view>
      </view>
    </view>
  </view>

  
  <!-- 扫码区域 -->
  <view class="scan-section">
    <!-- 扫描标题移除 -->
    <view class="scan-description">请将二维码放入框内进行扫描</view>
    
    <!-- 扫码按钮 -->
    <view class="scan-button-container">
      <button 
        class="scan-button {{isScanning ? 'scanning' : ''}}" 
        bindtap="startScan"
        disabled="{{isScanning}}">
        <view class="scan-icon">
          <image 
            src="{{isScanning ? '/images/icons/scanning.png' : '/images/icons/scan.png'}}" 
            class="icon">
          </image>
        </view>
        <view class="scan-text">
          {{isScanning ? '正在扫描...' : '开始扫码'}}
        </view>
      </button>
    </view>

    <!-- 扫码结果 -->
    <view class="scan-result" wx:if="{{scanResult}}">
      <view class="result-title">扫码结果</view>
      <view class="result-content">{{scanResult}}</view>
    </view>
  </view>

  




<!-- 完成提示弹窗（自定义） -->
<view class="modal-overlay" wx:if="{{completionModalVisible}}">
  <view class="modal">
    <view class="modal-title">打卡完成</view>
    <view class="modal-content">
      <view class="modal-line">✨恭喜你打卡全部完成，<text class="justify-filler"></text></view>
      <view class="modal-line">请到<text class="bold">签到处</text>领取你的奖品！✨<text class="justify-filler"></text></view>
    </view>
    <view class="modal-actions">
      <button class="btn-primary" bindtap="closeCompletionModal">确定</button>
    </view>
  </view>
</view>
</view>